---
title: FreeRTOS-1
tags:
  - FreeRTOS
  - STM32
  - C语言
categories:
  - STM32
description: FreeRTOS基本知识
date: 2023-08-27 10:30:00
---


我是跟着正点原子的教程来学的，感觉讲的可以，因此很多知识点参考了正点原子

# 为何使用FreeRTOS

裸机在处理任务时，可以采用主函数while循环加中断处理函数的方法，但是这种方法实时性差，代码结构臃肿，并且当某个任务要执行delay()时，CPU只能干等，无法在这段时间去处理其他任务，不能充分利用CPU资源。

FreeRTOS为每个任务划分时间片，优先级。优先级相同的任务在执行时在划分的时间片内执行。在某个任务堵塞(delay)时，该任务进入堵塞状态，CPU可以转去执行其他的任务。

# FreeRTOS任务调度

## 任务调度器

任务调度器就是通过某种调度算法决定要执行哪一个任务

## 任务调度方式
- 抢占式调度
  - 高优先级抢占低优先级
  - **被抢占的任务会进入就绪态**
  - 高优先级不结束，低优先级不能执行
- 时间片调度
  - **优先级相同**的任务会划分时间片，
  - **每个任务执行一个时间片**，执行完后不断流转
  - **时间片的大小取决于系统滴答定时器**
  - 倘若某个任务有一楼最好原因只执行0.2个时间片，那么在后面的运行中这个缺少的时间片并不会补回来，还是按照一个时间片执行
- 协程式调度

## 任务状态
- 运行态：某个任务正在被执行，那么该任务就处于运行态。在STM32中，只有一个任务处于运行态
- 就绪态：某个任务可以被执行，但是还未被执行，那么就处于就绪态
- 阻塞态：某任务在等待延时或者外部事件，则处于阻塞态
- 挂起态：类似于暂停，使用函数vTaskSuspend()挂起，使用vTaskResume()解挂，进入就绪态

<div align=center>
<img src="FreeRTOS-1-1.png" height = '360'>
</div>

由上图可知，**仅有就绪态可以转变成运行态；任何任务想要转变为运行态，都要先转变成就绪态**

## 任务列表

除运行态外，其他三种状态都有任务列表

- 就绪列表

| 标志位 | 任务列表              |
| ------ | --------------------- |
| bit31  | pxReadyTasksLists[31] |
| bit30  | pxReadyTasksLists[30] |
| ·····  | ····················· |
| bit1   | pxReadyTasksLists[1]  |
| bit0   | pxReadyTasksLists[0]  |

标志位置一表示该就绪态优先级列表有任务，反之无任务。

数字越大，优先级等级越高。这一点与STM32中断优先级的高低不一样。

任务调度器就是在就绪列表中选择优先级最高的任务来执行，即进入运行态。

- 阻塞列表：pxDelayedTaskList
- 挂起列表：xSuspendedTaskList


  








